<Window x:Class="DesktopPet.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        mc:Ignorable="d"
        Title="DesktopPet" Height="250" Width="250"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize">
        
    <Grid Background="{x:Null}">
        <Grid.ContextMenu>
            <ContextMenu>
                <MenuItem Header="Reset Position" Click="OnResetPosition"/>
                <Separator/>
                <MenuItem Header="Dashboard" Click="OnOpenSettings"/>
                <Separator/>
                <MenuItem Header="Exit" Click="OnExit"/>
            </ContextMenu>
        </Grid.ContextMenu>

        <!-- Taskbar Icon (Tray) -->
        <tb:TaskbarIcon x:Name="MyNotifyIcon"
                        ToolTipText="Desktop Pet">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Reset Position" Click="OnResetPosition"/>
                    <Separator/>
                    <MenuItem Header="Dashboard" Click="OnOpenSettings"/>
                    <Separator/>
                    <MenuItem Header="Exit" Click="OnExit"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

        <!-- Pet Visuals -->
        <!-- Pet Visuals -->
        <!-- Simple Slime/Ghost Shape (Fallback, hidden by Image if opaque, but good to keep behind if needed) -->
        <Path Fill="#FF6C5CE7" Stroke="#FF4834D4" StrokeThickness="2"
              Data="M 20,60 C 20,20 80,20 80,60 C 80,90 20,90 20,60"
              HorizontalAlignment="Center" VerticalAlignment="Center"
              Visibility="Collapsed">
            <Path.Effect>
                <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
            </Path.Effect>
        </Path>

        <!-- Eyes (Collapsed) -->
        <Ellipse Width="8" Height="12" Fill="White" Margin="35,45,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Visibility="Collapsed"/>
        <Ellipse Width="8" Height="12" Fill="White" Margin="0,45,35,0" HorizontalAlignment="Right" VerticalAlignment="Top" Visibility="Collapsed"/>
        
        <!-- Pupils (Collapsed) -->
        <Ellipse Width="4" Height="4" Fill="Black" Margin="37,49,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Visibility="Collapsed"/>
        <Ellipse Width="4" Height="4" Fill="Black" Margin="0,49,37,0" HorizontalAlignment="Right" VerticalAlignment="Top" Visibility="Collapsed"/>

        <!-- Phase 2: High Performance Renderer -->
        <!-- Fix clipping on stretch: Leave top space empty by aligning bottom with fixed height -->
        <Image x:Name="PetImage"
               Margin="10"
               VerticalAlignment="Center" HorizontalAlignment="Center"
               RenderOptions.BitmapScalingMode="HighQuality"
               Stretch="Uniform"
               IsHitTestVisible="True">
            <Image.Effect>
                 <!-- Grounding Shadow to fix 'disjointed' feel -->
                <DropShadowEffect Color="Black" BlurRadius="6" ShadowDepth="3" Opacity="0.4" Direction="270"/>
            </Image.Effect>
        </Image>

    </Grid>
</Window>
